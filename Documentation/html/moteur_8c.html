<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TP_AAA: D:/TP_TD_ENSEA_3A/AUTO/2425_ESE3745_BELKHIR_LY/stm32Projet/Core/Src/mylibs/moteur.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">TP_AAA
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_275089585c7fc1b5fd5d7d42c69cb1da.html">D:</a></li><li class="navelem"><a class="el" href="dir_465ae9aeb27c4c9a4ee002f09b6811a7.html">TP_TD_ENSEA_3A</a></li><li class="navelem"><a class="el" href="dir_06c4035a5976002d8d67802f0620e971.html">AUTO</a></li><li class="navelem"><a class="el" href="dir_04a0c3f17c08be1bd09bb4d2956dfd6b.html">2425_ESE3745_BELKHIR_LY</a></li><li class="navelem"><a class="el" href="dir_6b66847eacc880f6e53247c0470d14a5.html">stm32Projet</a></li><li class="navelem"><a class="el" href="dir_4a5d4a458c5dc55b3f2779c2b728fed7.html">Core</a></li><li class="navelem"><a class="el" href="dir_3867875833f62fbd30527522fae8ad32.html">Src</a></li><li class="navelem"><a class="el" href="dir_b83cd5f5a2c7e1ccff482a9ab6601fea.html">mylibs</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">moteur.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Implémentation des fonctions de contrôle du moteur via les signaux PWM.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;mylibs/moteur.h&quot;</code><br />
<code>#include &quot;tim.h&quot;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &quot;adc.h&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:abb163b2eaa21085ca1efa176e5fede2f" id="r_abb163b2eaa21085ca1efa176e5fede2f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abb163b2eaa21085ca1efa176e5fede2f">moteurSetSpeed</a> (char *cmd)</td></tr>
<tr class="memdesc:abb163b2eaa21085ca1efa176e5fede2f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Définit la vitesse du moteur en fonction de la commande reçue.  <br /></td></tr>
<tr class="separator:abb163b2eaa21085ca1efa176e5fede2f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6b818c4839a7c2cddfb1d00dbf56b9d" id="r_ad6b818c4839a7c2cddfb1d00dbf56b9d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad6b818c4839a7c2cddfb1d00dbf56b9d">moteurStart</a> (void)</td></tr>
<tr class="memdesc:ad6b818c4839a7c2cddfb1d00dbf56b9d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Démarre le moteur en fixant un rapport cyclique initial de 50%.  <br /></td></tr>
<tr class="separator:ad6b818c4839a7c2cddfb1d00dbf56b9d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d0e303e234c350d342e0e523c716dee" id="r_a3d0e303e234c350d342e0e523c716dee"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3d0e303e234c350d342e0e523c716dee">moteurStop</a> (void)</td></tr>
<tr class="memdesc:a3d0e303e234c350d342e0e523c716dee"><td class="mdescLeft">&#160;</td><td class="mdescRight">Arrête le moteur en fixant le rapport cyclique à 0%.  <br /></td></tr>
<tr class="separator:a3d0e303e234c350d342e0e523c716dee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a03473b1460cd766771c91e5ed5e75be9" id="r_a03473b1460cd766771c91e5ed5e75be9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a03473b1460cd766771c91e5ed5e75be9">displayCurrent</a> (void)</td></tr>
<tr class="memdesc:a03473b1460cd766771c91e5ed5e75be9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Lit la valeur actuelle du courant via le tampon DMA et l'affiche sur la console.  <br /></td></tr>
<tr class="separator:a03473b1460cd766771c91e5ed5e75be9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adaa4be128fe3cf007506a431e945855a" id="r_adaa4be128fe3cf007506a431e945855a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#adaa4be128fe3cf007506a431e945855a">ADC_DMA_Init</a> (void)</td></tr>
<tr class="memdesc:adaa4be128fe3cf007506a431e945855a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialise l'ADC en mode DMA avec déclenchement par TIMER.  <br /></td></tr>
<tr class="separator:adaa4be128fe3cf007506a431e945855a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e13d5e804153755eac47dab3aed5b63" id="r_a5e13d5e804153755eac47dab3aed5b63"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5e13d5e804153755eac47dab3aed5b63">getCurrent</a> (void)</td></tr>
<tr class="memdesc:a5e13d5e804153755eac47dab3aed5b63"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calcule le courant mesuré à partir des données ADC.  <br /></td></tr>
<tr class="separator:a5e13d5e804153755eac47dab3aed5b63"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae32de4a248b0327eaa5786caa64a68bf" id="r_ae32de4a248b0327eaa5786caa64a68bf"><td class="memItemLeft" align="right" valign="top">int16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae32de4a248b0327eaa5786caa64a68bf">getPos</a> (void)</td></tr>
<tr class="memdesc:ae32de4a248b0327eaa5786caa64a68bf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retourne la position actuelle du moteur à partir du compteur du Timer.  <br /></td></tr>
<tr class="separator:ae32de4a248b0327eaa5786caa64a68bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a647f18f75ad8f9c01bca1be5e47b706b" id="r_a647f18f75ad8f9c01bca1be5e47b706b"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a647f18f75ad8f9c01bca1be5e47b706b">getSpeed</a> (int16_t oldpos)</td></tr>
<tr class="memdesc:a647f18f75ad8f9c01bca1be5e47b706b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calcule la vitesse de rotation du moteur en tours par minute (RPM).  <br /></td></tr>
<tr class="separator:a647f18f75ad8f9c01bca1be5e47b706b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implémentation des fonctions de contrôle du moteur via les signaux PWM. </p>
<dl class="section author"><dt>Author</dt><dd>Aliou LY (<a href="#" onclick="location.href='mai'+'lto:'+'ali'+'ou'+'.ly'+'@e'+'nse'+'a.'+'fr'; return false;">aliou<span class="obfuscator">.nosp@m.</span>.ly@<span class="obfuscator">.nosp@m.</span>ensea<span class="obfuscator">.nosp@m.</span>.fr</a>) </dd></dl>
<dl class="section version"><dt>Version</dt><dd>0.1 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2024-11-09</dd></dl>
<p>Ce fichier contient les fonctions permettant de démarrer, arrêter et ajuster la vitesse du moteur. La vitesse est contrôlée par un signal PWM, dont le rapport cyclique est ajusté progressivement pour éviter les transitions brutales. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="adaa4be128fe3cf007506a431e945855a" name="adaa4be128fe3cf007506a431e945855a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adaa4be128fe3cf007506a431e945855a">&#9670;&#160;</a></span>ADC_DMA_Init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ADC_DMA_Init </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialise l'ADC en mode DMA avec déclenchement par TIMER. </p>
<p>Configure le DMA pour transférer les données ADC dans un tampon et démarre le TIMER pour assurer un déclenchement périodique des conversions ADC. </p>

</div>
</div>
<a id="a03473b1460cd766771c91e5ed5e75be9" name="a03473b1460cd766771c91e5ed5e75be9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a03473b1460cd766771c91e5ed5e75be9">&#9670;&#160;</a></span>displayCurrent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void displayCurrent </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Lit la valeur actuelle du courant via le tampon DMA et l'affiche sur la console. </p>
<p>Cette fonction lit la dernière valeur convertie par l'ADC (gérée en arrière-plan par le DMA), calcule le courant correspondant à l'aide des paramètres calibrés, puis affiche la valeur du courant sur la console via <code>printf</code>. </p>

</div>
</div>
<a id="a5e13d5e804153755eac47dab3aed5b63" name="a5e13d5e804153755eac47dab3aed5b63"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5e13d5e804153755eac47dab3aed5b63">&#9670;&#160;</a></span>getCurrent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float getCurrent </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calcule le courant mesuré à partir des données ADC. </p>
<p>Cette fonction lit la dernière valeur du tampon ADC (rempli automatiquement par DMA), calcule la tension de sortie correspondante, puis convertit cette tension en courant en utilisant une formule calibrée.</p>
<dl class="section return"><dt>Returns</dt><dd>Le courant mesuré en ampères (float). </dd></dl>

</div>
</div>
<a id="ae32de4a248b0327eaa5786caa64a68bf" name="ae32de4a248b0327eaa5786caa64a68bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae32de4a248b0327eaa5786caa64a68bf">&#9670;&#160;</a></span>getPos()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int16_t getPos </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retourne la position actuelle du moteur à partir du compteur du Timer. </p>
<p>Cette fonction lit la valeur actuelle du compteur du Timer (TIM3), configuré en mode encodeur, pour déterminer la position du moteur.</p>
<dl class="section return"><dt>Returns</dt><dd>La position actuelle du moteur en tant qu'entier 16 bits signé. </dd></dl>

</div>
</div>
<a id="a647f18f75ad8f9c01bca1be5e47b706b" name="a647f18f75ad8f9c01bca1be5e47b706b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a647f18f75ad8f9c01bca1be5e47b706b">&#9670;&#160;</a></span>getSpeed()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float getSpeed </td>
          <td>(</td>
          <td class="paramtype">int16_t</td>          <td class="paramname"><span class="paramname"><em>oldpos</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calcule la vitesse de rotation du moteur en tours par minute (RPM). </p>
<p>Cette fonction utilise la différence entre une position précédente et la position actuelle pour calculer la vitesse de rotation du moteur. La vitesse est exprimée en tours par minute (RPM) en utilisant la fréquence d'échantillonnage du système (Fe).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">oldpos</td><td>La position précédente du moteur, obtenue à partir de <code><a class="el" href="#ae32de4a248b0327eaa5786caa64a68bf" title="Retourne la position actuelle du moteur à partir du compteur du Timer.">getPos()</a></code>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>La vitesse de rotation calculée en tours par minute (RPM) sous forme de nombre flottant. </dd></dl>

</div>
</div>
<a id="abb163b2eaa21085ca1efa176e5fede2f" name="abb163b2eaa21085ca1efa176e5fede2f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb163b2eaa21085ca1efa176e5fede2f">&#9670;&#160;</a></span>moteurSetSpeed()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void moteurSetSpeed </td>
          <td>(</td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>cmd</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Définit la vitesse du moteur en fonction de la commande reçue. </p>
<p>Cette fonction reçoit une commande de type char* représentant la vitesse souhaitée, la convertit en un entier, et la limite entre 0 et VITESSE_MAX. Elle ajuste ensuite le rapport cyclique PWM.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cmd</td><td>La commande de vitesse souhaitée transmise par UART </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ad6b818c4839a7c2cddfb1d00dbf56b9d" name="ad6b818c4839a7c2cddfb1d00dbf56b9d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad6b818c4839a7c2cddfb1d00dbf56b9d">&#9670;&#160;</a></span>moteurStart()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void moteurStart </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Démarre le moteur en fixant un rapport cyclique initial de 50%. </p>
<p>Cette fonction initialise le moteur avec un rapport cyclique correspondant à une vitesse de 50%. Elle configure les canaux TIM_CHANNEL1 et TIM_CHANNEL2 et les complémentaires pour démarrer le moteur. </p>

</div>
</div>
<a id="a3d0e303e234c350d342e0e523c716dee" name="a3d0e303e234c350d342e0e523c716dee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d0e303e234c350d342e0e523c716dee">&#9670;&#160;</a></span>moteurStop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void moteurStop </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Arrête le moteur en fixant le rapport cyclique à 0%. </p>
<p>Cette fonction stoppe le moteur en mettant le rapport cyclique des canaux TIM_CHANNEL1 et TIM_CHANNEL2 à 0. Elle arrête le signal PWM pour chaque canal. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
